<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Guides for Supervised Learning - 8&nbsp; Text Mining</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./tree-based.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./text-mining.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Text Mining</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Guides for Supervised Learning</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Visualization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model-accuracy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Model accuracy and fit</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./linear-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Linear Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">classification</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./beyond-linearity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Beyond linearity</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tree-based.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Tree-based Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./text-mining.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Text Mining</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#readings" id="toc-readings" class="nav-link active" data-scroll-target="#readings"><span class="header-section-number">8.1</span> Readings</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">8.2</span> Introduction</a></li>
  <li><a href="#preprocessing-data" id="toc-preprocessing-data" class="nav-link" data-scroll-target="#preprocessing-data"><span class="header-section-number">8.3</span> Preprocessing data</a></li>
  <li><a href="#typical-steps" id="toc-typical-steps" class="nav-link" data-scroll-target="#typical-steps"><span class="header-section-number">8.4</span> typical steps</a></li>
  <li><a href="#vector-space-model" id="toc-vector-space-model" class="nav-link" data-scroll-target="#vector-space-model"><span class="header-section-number">8.5</span> Vector Space Model</a></li>
  <li><a href="#bag-of-words" id="toc-bag-of-words" class="nav-link" data-scroll-target="#bag-of-words"><span class="header-section-number">8.6</span> Bag-of-Words</a>
  <ul class="collapse">
  <li><a href="#tfidf" id="toc-tfidf" class="nav-link" data-scroll-target="#tfidf"><span class="header-section-number">8.6.1</span> TFiDF</a></li>
  </ul></li>
  <li><a href="#overview-of-vsm-models" id="toc-overview-of-vsm-models" class="nav-link" data-scroll-target="#overview-of-vsm-models"><span class="header-section-number">8.7</span> Overview of VSM models</a></li>
  <li><a href="#text-classification" id="toc-text-classification" class="nav-link" data-scroll-target="#text-classification"><span class="header-section-number">8.8</span> Text classification</a></li>
  <li><a href="#algorithms" id="toc-algorithms" class="nav-link" data-scroll-target="#algorithms"><span class="header-section-number">8.9</span> Algorithms</a></li>
  <li><a href="#word-represenation" id="toc-word-represenation" class="nav-link" data-scroll-target="#word-represenation"><span class="header-section-number">8.10</span> Word represenation</a></li>
  <li><a href="#in-r" id="toc-in-r" class="nav-link" data-scroll-target="#in-r"><span class="header-section-number">8.11</span> in R</a>
  <ul class="collapse">
  <li><a href="#pre-processing-text-tidy-approach" id="toc-pre-processing-text-tidy-approach" class="nav-link" data-scroll-target="#pre-processing-text-tidy-approach"><span class="header-section-number">8.11.1</span> Pre-Processing Text: Tidy approach</a></li>
  <li><a href="#step-1-tokenization-un-nesting-text" id="toc-step-1-tokenization-un-nesting-text" class="nav-link" data-scroll-target="#step-1-tokenization-un-nesting-text"><span class="header-section-number">8.11.2</span> Step 1: Tokenization, un-nesting Text</a></li>
  <li><a href="#intermezzo-word-clouds" id="toc-intermezzo-word-clouds" class="nav-link" data-scroll-target="#intermezzo-word-clouds"><span class="header-section-number">8.11.3</span> Intermezzo: Word clouds</a></li>
  <li><a href="#step-2-removing-stop-words" id="toc-step-2-removing-stop-words" class="nav-link" data-scroll-target="#step-2-removing-stop-words"><span class="header-section-number">8.11.4</span> Step 2: Removing stop words</a></li>
  </ul></li>
  <li><a href="#vector-space-model-document-term-matrix" id="toc-vector-space-model-document-term-matrix" class="nav-link" data-scroll-target="#vector-space-model-document-term-matrix"><span class="header-section-number">8.12</span> Vector space model: document-term matrix</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Text Mining</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="readings" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="readings"><span class="header-section-number">8.1</span> Readings</h2>
<p><a href="https://www.tidytextmining.com">Welcome to Text Mining with R</a></p>
<ul>
<li>Chapter 1: The tidy text format – Chapter 2: Sentiment analysis with tidy data</li>
<li>Chapter 3: Analyzing word and document frequency: tf-idf</li>
</ul>
</section>
<section id="introduction" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="introduction"><span class="header-section-number">8.2</span> Introduction</h2>
<p>Lecturer: Ayoub Bagheri</p>
<p><strong>What is text mining?</strong></p>
<ul>
<li>most popular: “The discovery by computer of }new, previously unknown information}, by automatically extracting information from different written resources” (Hearst 1999)</li>
<li>Text mining is about looking for <em>patterns in text</em>, in a similar way that data mining can be loosely described as looking for patterns in data.</li>
<li>Text mining describes a set of linguistic, statistical, and machine learning techniques that model and <em>structure the information content of textual sources</em> (Wikipedia)</li>
</ul>
<p><strong>Why text mining?</strong></p>
<p>Text data is everywhere, websites (e.g., news), social media (e.g., twitter), databases (e.g., doctors’ notes), digital scans of printed materials, … - A lot of world’s data is in unstructured text format - Applications in industry: search, machine translation, sentiment analysis, question answering, … - Applications in science: cognitive modeling , understanding bias in language, automated systematic literature reviews, …</p>
<p><strong>Examples for text mining:</strong></p>
<ul>
<li>Who was the best friend in Friends?</li>
<li>using text mining instead of hand assignment in the automatic detection of ICD10 codes in cardiology discharge letters</li>
</ul>
<p><strong>understanding language is difficult!</strong></p>
<p>(at least half of them are an open problem)</p>
<ul>
<li>Different things can mean more or less the same ( data science ” vs.statistics</li>
<li>Context dependency (You have very nice shoes)</li>
<li>Same words with different meanings (to sanction)</li>
<li>Lexical ambiguity (we saw her duck)</li>
<li>Irony, sarcasm (You should swallow disinfectant)</li>
<li>Figurative language (He has a heart of stone)</li>
<li>Negation (not good ” vs.&nbsp;good ””), spelling variations, jargon, abbreviations</li>
<li>All the above is different over languages,99 % of work is on English!</li>
</ul>
<p><strong>Key problem</strong></p>
<ul>
<li>Text, images, videos is unstructured data, not tidy</li>
<li>unstructured text: information that either does not have a pre defined data model or is not organized in a pre defined manner.</li>
<li>for our analysis we need tidy data</li>
<li>each variable is a column, each observation a row, each type of observational unit is a table → table with one-token-per-row</li>
<li>token is a meaningful unit of text, such as a word, that we are interested in using for analysis</li>
<li>how is data stored in text mining approaches?</li>
<li>string, character vectors</li>
<li>corpus: contain raw string strings annotated with additional meta data and details</li>
<li>document-term matrix: sparse matrix describing a collection (i.e., a corpus) of documents with one row for each document and one column for each term. The value in the matrix is typically word count or tf-idf. In other words: is a mathematical matrix that describes the frequency of terms that occur in a collection of documents</li>
<li>→ How is it possible to convert this data to structured one?</li>
<li>answer: tokenization, the process of splitting text into tokens</li>
</ul>
</section>
<section id="preprocessing-data" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="preprocessing-data"><span class="header-section-number">8.3</span> Preprocessing data</h2>
<ul>
<li>approach for cleaning and noise removal of text data</li>
<li>brings text in analyzable form for statistical learning</li>
<li>is useful, because:</li>
<li>efficient</li>
<li>remove stop words - def: words which are filtered out before or after processing of natural language data (text)</li>
<li>reduce noise</li>
<li>is tidy and structured</li>
<li>dimensionality: words as features in columns</li>
<li>memory allocation</li>
<li>increase performance</li>
</ul>
</section>
<section id="typical-steps" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="typical-steps"><span class="header-section-number">8.4</span> typical steps</h2>
<p>not all of these are appropriate at all times!</p>
<ul>
<li>tokenization Tokenization (“text”, “ming”, “is”, “the”, “best”, “!”)</li>
<li>stemming (“lungs” to “lung”) or Lemmatization (“were”to “is”)
<ul>
<li>def: the process for reducing inflected (or sometimes derived) words to their word stem, base or root form generally a written word form</li>
</ul></li>
<li>lowercasing (“Disease” to “disease”)</li>
<li>stopword removal (“text mining is best!”)</li>
<li>punctual removal (“text mining is the best”)</li>
<li>number removal (“I42” to “I”)</li>
<li>spell correction (“hart” to “heart”)</li>
</ul>
<p>Example for steps, one step behind another with a <strong>Vector Space Model</strong> as a result:</p>
<p><img src="figures/9.ex.png" class="img-fluid" width="490"></p>
</section>
<section id="vector-space-model" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="vector-space-model"><span class="header-section-number">8.5</span> Vector Space Model</h2>
<p><strong>Basic idea</strong>: Represent the text as something that makes sense to a computer, makes it readable for the computer</p>
<ul>
<li>is a collection of vectors</li>
<li>represents documents by concept vectors</li>
<li>each concept defines one dimension (one dimension can be one word)</li>
<li>k concepts define a high-dimensional space</li>
<li>element of vector corresponds to concept weight</li>
<li>terms/ words are genereic features that can be extracted from text</li>
<li>typically, terms are single words, keywords, n/grams, or phrases</li>
<li>documents are represented as vectors of terms</li>
<li>each dimension (concept) corresponds to a separate term</li>
</ul>
<p><span class="math display">\[
d= (w_1, \dots,  w_n)
\]</span></p>
<p><img src="figures/9.ex.png" class="img-fluid" width="400"></p>
<ul>
<li>The process of converting text into numbers is called <strong>Vectorization</strong></li>
<li>Distance between the vectors in this concept space illustrate the relationsship between the documents</li>
</ul>
</section>
<section id="bag-of-words" class="level2" data-number="8.6">
<h2 data-number="8.6" class="anchored" data-anchor-id="bag-of-words"><span class="header-section-number">8.6</span> Bag-of-Words</h2>
<p>How can we convert words in numerical values? You need a vocabulary that works for all articles, so a binary approach!</p>
<ul>
<li>Terms are words (more guenereally we can use n-grams)</li>
<li>weights are numbers of occurrences of the terms int eh document</li>
<li>binary</li>
<li>term frequency (TF)</li>
<li>term Frequency inverse Document Frequency (TFiDF)</li>
</ul>
<p>Looking at all words in all articles and give zeros and ones, if the term occur or not:</p>
<p><img src="figures/9.bag.png" class="img-fluid" width="400"></p>
<section id="tfidf" class="level3" data-number="8.6.1">
<h3 data-number="8.6.1" class="anchored" data-anchor-id="tfidf"><span class="header-section-number">8.6.1</span> TFiDF</h3>
<p>A term is more discriminative if it occurs a lot but only in fewer documents → shows how often the words occur and how important it is!</p>
<ol type="1">
<li>How often? Let <span class="math inline">\(n_{d,t}\)</span> denote the number of times the t-th term appear in the d-th document</li>
</ol>
<p><span class="math display">\[
TF_{d,t} = \frac{n_{d,t}}{\sum_{i}n_{d,i}}
\]</span></p>
<ol start="2" type="1">
<li>how important? Let N denote the number of documents and <span class="math inline">\(N_t\)</span> denote the number of documents containing the t-th term.</li>
</ol>
<p><span class="math display">\[
IDF_t = log (\frac{N}{N_t})
\]</span></p>
<p>When a word appears in all of the documents, it cancelled out by how important that is.</p>
<p>And then weight with TFiDF:</p>
<p><span class="math display">\[
w_{d,t} = TF_{d,t} * IDF_t
\]</span></p>
</section>
</section>
<section id="overview-of-vsm-models" class="level2" data-number="8.7">
<h2 data-number="8.7" class="anchored" data-anchor-id="overview-of-vsm-models"><span class="header-section-number">8.7</span> Overview of VSM models</h2>
<p><img src="figures/9.vsm.png" class="img-fluid" width="490"></p>
<p>overview about the method:</p>
<p>three categories of vector space model</p>
<ol type="1">
<li>bag-of-words<br>
We do not care about the order of words, so not about the meaning good to convert to a table high dimensional, high number of zeros (sparse)</li>
<li>topics we expect 10 topics or clusters use these topics as vectors</li>
<li>word embeddings we care about the order and the meaning</li>
</ol>
</section>
<section id="text-classification" class="level2" data-number="8.8">
<h2 data-number="8.8" class="anchored" data-anchor-id="text-classification"><span class="header-section-number">8.8</span> Text classification</h2>
<ul>
<li>supervised learning: learning a function that maps an input to an output based on example input-output pairs
<ul>
<li>infer function from labeled training data</li>
<li>use inferred function to label new instances</li>
</ul></li>
<li>common: human experts annotate a set of text data as a training set</li>
</ul>
<p>hand-coded rules</p>
<ul>
<li>rules based on combinations of words or other features</li>
<li>accuracy can be high if rules are carefully defined by experts</li>
<li>data/domain specific</li>
</ul>
</section>
<section id="algorithms" class="level2" data-number="8.9">
<h2 data-number="8.9" class="anchored" data-anchor-id="algorithms"><span class="header-section-number">8.9</span> Algorithms</h2>
<ul>
<li>Naïve Bayes</li>
<li>Logistic regression</li>
<li>Support vector machines</li>
<li>K nearest neighbors</li>
<li>Neural networks</li>
<li>Deep learning</li>
</ul>
</section>
<section id="word-represenation" class="level2" data-number="8.10">
<h2 data-number="8.10" class="anchored" data-anchor-id="word-represenation"><span class="header-section-number">8.10</span> Word represenation</h2>
<ul>
<li>how can we represent the meaning of words?</li>
</ul>
<p>Words as vectors:</p>
<ul>
<li><p>capture semantics:</p></li>
<li><p>similar words should be close to each other in the vector space</p></li>
<li><p>relation between two vectors should reflect the relationship between the two words</p></li>
<li><p>be efficient, because smaller number of vectors and dimensions</p></li>
<li><p>be interpretable</p></li>
</ul>
</section>
<section id="in-r" class="level2" data-number="8.11">
<h2 data-number="8.11" class="anchored" data-anchor-id="in-r"><span class="header-section-number">8.11</span> in R</h2>
<pre><code>## libraries
library(tidytext)
library(RColorBrewer)
library(gutenbergr)
library(SnowballC)
library(wordcloud)
library(textdata)
library(tm)
library(NLP)
library(stringi)
library(e1071)
library(rpart)
library(caret)

## Preprocessing tidy data apporoach
  #each line get a number and each chapter reference a number, too in the book Alice in Wonderland
tidy_AAIWL &lt;- AAIWL %&gt;%
  mutate(linenumber = row_number(),
         chapter = cumsum(str_detect(text, regex("^chapter [\\divxlc]",
                                                 ignore_case = TRUE))))
## Tokenization, un-nesting Text
  #each word in the column text gets is own row
tidy_AAIWL &lt;- tidy_AAIWL %&gt;% unnest_tokens(word, text)

#count the words
  #from most used descending 
tidy_AAIWL.count &lt;- tidy_AAIWL %&gt;% count(word, sort=TRUE)

#remove stopwords
data("stop_words")
tidy_AAIWL.stop &lt;- tidy_AAIWL %&gt;% anti_join(stop_words)

#create a word cloud out of it
tidy_AAIWL.count %&gt;% with(wordcloud(word, n, max.words = 100))                                        

#Vector Space Model
  #set the seed to make your partition reproducible
set.seed(123)

df_final$Content &lt;- iconv(df_final$Content, from = "UTF-8", to = "ASCII", sub = "")

  #for documenttermmatrix we need a corpus format, a list ot content and the meta data 
docs &lt;- Corpus(VectorSource(df_final$Content)) 

  ## alter the code from here onwards
dtm &lt;- DocumentTermMatrix(docs,
                          control = list(stopwords= TRUE, 
                                        removeNumbers=TRUE,
                                        removePunctuation=TRUE,
                                        whitespace_tokenizer=TRUE,
                                        tolower=TRUE))  #lower case

view(dtm)
  #in the rows are the entries, in the columns the frequency of a word

  ## we are not interested in all the words, we are only interested in words that are more ofte used than 10 times
not.freq &lt;- findFreqTerms(dtm, lowfreq=11) 
  #run again 
dtm &lt;- DocumentTermMatrix(docs,
                          control = list(stopwords= TRUE, 
                                        removeNumbers=TRUE,
                                        removePunctuation=TRUE,
                                        whitespace_tokenizer=TRUE,
                                        tolower=TRUE,
                                        dictionary = not.freq))  #lower case
   ## define the training partition 
train_index &lt;- createDataPartition(df_final$Category, p = .8,  #category because outcome variable
                                  list = FALSE, 
                                  times = 1)

  ## split the data using the training partition to obtain training data
df_train &lt;- df_final[train_index,]

  ## remainder of the split is the validation and test data (still) combined 
df_test &lt;- df_final[-train_index,] 

df_train$Content &lt;- iconv(df_train$Content, from = "UTF-8", to = "ASCII", sub = "")
df_test$Content &lt;- iconv(df_test$Content, from = "UTF-8", to = "ASCII", sub = "")

docs_train &lt;- Corpus(VectorSource(df_train$Category)) 
docs_test &lt;- Corpus(VectorSource(df_test$Category)) 

## alter the code from here onwards
dtm_train &lt;- DocumentTermMatrix(docs_train,
                          control = list(stopwords= TRUE, 
                                        removeNumbers=TRUE,
                                        removePunctuation=TRUE,
                                        whitespace_tokenizer=TRUE,
                                        tolower=TRUE,
                                        dictionary= not.freq))  

## alter the code from here onwards
dtm_test &lt;- DocumentTermMatrix(docs_test,
                          control = list(stopwords= TRUE, 
                                        removeNumbers=TRUE,
                                        removePunctuation=TRUE,
                                        whitespace_tokenizer=TRUE,
                                        tolower=TRUE,
                                        dictionary= not.freq))  

#make a data frame 
dtm_train  &lt;- as.data.frame(as.matrix(dtm_train))
dtm_test  &lt;- as.data.frame(as.matrix(dtm_test))

#now you can run a decision tree on it with
library(rpart)
fit_dt &lt;- rpart(cat~., data = dtm_train, method = 'class')
 
## prediction on training data
pred_train &lt;- predict(fit_dt, dtm_train, type = 'class')
fit_table  &lt;- table(dtm_train$cat, pred_train, dnn = c("Actual", "Predicted"))
fit_table

pred_test       &lt;- predict(fit_dt, dtm_test, type = 'class')
fit_table_test  &lt;- table(dtm_test$cat, pred_test, dnn = c("Actual", "Predicted"))
fit_table_test

## You can use this table to calculate Accuracy, Sensitivity, Specificity, Pos Pred Value, and Neg Pred Value. There are also many functions available for this purpose, for example the `confusionMatrix` function from the `caret` package.</code></pre>
<p>During this practical, we will cover an introduction to text mining. Topics covered are how to pre-process mined text (in both the tidy approach and using the <code>tm</code> package), different ways to visualize this the mined text, creating a document-term matrix and an introduction to one type of analysis you can conduct during text mining: text classification. As a whole, there are multiple ways to analysis mine &amp; analyze text within <code>R</code>. However, for this practical we will discuss some of the techniques covered in the <code>tm</code> package and in the <code>tidytext</code> package, based upon the <code>tidyverse</code>.</p>
<p>You can download the student zip including all needed files for practical 9 <a href="https://surfdrive.surf.nl/files/index.php/s/J58fxg4AkOSKTcK">here</a>. In addition, for this practical, you will need the following packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## General Packages</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Text Mining</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gutenbergr)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SnowballC)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wordcloud)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(textdata)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tm)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NLP)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringi)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For the first part of the practical, we will be using text mined through the <a href="https://www.gutenberg.org/wiki/Main_Page">Gutenberg Project</a>; briefly this project contains over 60,000 freely accessible eBooks, which through the package <code>gutenberger</code>, can be easily accessed and perfect for text mining and analysis.</p>
<p>We will be looking at several books from the late 1800s, in the mindset to compare and contrast the use of language within them. These books include:</p>
<ul>
<li><em>Alice’s Adventures in Wonderland by Lewis Carroll</em></li>
<li><em>The Strange Case of Dr.&nbsp;Jekyll and Mr.&nbsp;Hyde by Robert Louis Stevenson</em></li>
</ul>
<p>Despite being from the late 1800s, these books still are popular and hold cultural significance in TV, Movies and the English Language. To access this novel suitable for this practical the following function should be used:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>AAIWL <span class="ot">&lt;-</span> <span class="fu">gutenberg_download</span>(<span class="dv">28885</span>) <span class="do">## 28885 is the eBook number of Alice in Wonderland</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>SCJH  <span class="ot">&lt;-</span> <span class="fu">gutenberg_download</span>(<span class="dv">43</span>)    <span class="do">## 43 is the eBook number of Dr. Jekyll and Mr. Hyde</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After having loaded all of these books into your working directory (using the code above), examine one of these books using the <code>View()</code> function. When you view any of these data frames, you will see that these have an extremely <em>messy</em> layout and structure. As a result of this complex structure means that conducting <em>any</em> analysis would be extremely challenging, so pre-processing must be undertaken to get this into a format which is usable.</p>
<section id="pre-processing-text-tidy-approach" class="level3" data-number="8.11.1">
<h3 data-number="8.11.1" class="anchored" data-anchor-id="pre-processing-text-tidy-approach"><span class="header-section-number">8.11.1</span> Pre-Processing Text: Tidy approach</h3>
<p>In order for text to be used effectively within statistical processing and analysis; it must be pre-processed so that it can be uniformly examined. Typical steps of pre-processing include:</p>
<ul>
<li>Removing numbers</li>
<li>Converting to lowercase</li>
<li>Removing stop words</li>
<li>Removing punctuation</li>
<li>Stemming</li>
</ul>
<p>These steps are important as they allow the text to be presented uniformly for analysis (but remember we do not always need all of them); within this practical we will discuss how to undergo some of these steps.</p>
</section>
<section id="step-1-tokenization-un-nesting-text" class="level3" data-number="8.11.2">
<h3 data-number="8.11.2" class="anchored" data-anchor-id="step-1-tokenization-un-nesting-text"><span class="header-section-number">8.11.2</span> Step 1: Tokenization, un-nesting Text</h3>
<p>When we previously looked at this text, as we discovered it was extremely <em>messy</em> with it being attached one line per row in the data frame. As such, it is important to un-nest this text so that it attaches one word per row.</p>
<p>Before un-nesting text, it is useful to make a note of aspects such as the line which text is on, and the chapter each line falls within. This can be important when examining anthologies or making chapter comparisons as this can be specified within the analysis.</p>
<p>In order to specify the line number and chapter of the text, it is possible to use the <code>mutuate</code> function from the <code>dplyr</code> package.</p>
<ol type="1">
<li><strong>Apply the code below, which uses the <code>mutate</code> function, to add line numbers and chapter references one of the books. Next, use the <code>View()</code> function to examine how this has changed the structure.</strong></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Template:</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>tidy_AAIWL <span class="ot">&lt;-</span> AAIWL <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">linenumber =</span> <span class="fu">row_number</span>(),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">chapter =</span> <span class="fu">cumsum</span>(<span class="fu">str_detect</span>(text, <span class="fu">regex</span>(<span class="st">"^chapter [</span><span class="sc">\\</span><span class="st">divxlc]"</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>tidy_SCJH <span class="ot">&lt;-</span> SCJH  <span class="sc">%&gt;%</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">linenumber =</span> <span class="fu">row_number</span>(),</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">chapter =</span> <span class="fu">cumsum</span>(<span class="fu">str_detect</span>(text, <span class="fu">regex</span>(<span class="st">"^chapter [</span><span class="sc">\\</span><span class="st">divxlc]"</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>`</p>
<p>From this, it is now possible to pass the function <code>unnest_tokens()</code> in order to split apart the sentence string, and apply each word to a new line. When using this function, you simply need to pass the arguments, <code>word</code> (as this is what you want selecting) and <code>text</code> (the name of the column you want to unnest).</p>
<p>The two basic arguments to unnest_tokens used here are column names. First we have the output column name that will be created as the text is unnested into it (word, in this case), and then the input column that the text comes from (text, in this case). Remember that text_df above has a column called text that contains the data of interest.</p>
<p>After using unnest_tokens, we’ve split each row so that there is one token (word) in each row of the new data frame; the default tokenization in unnest_tokens() is for single words, as shown here. Also notice:</p>
<p>Other columns, such as the line number each word came from, are retained. Punctuation has been stripped. By default, unnest_tokens() converts the tokens to lowercase, which makes them easier to compare or combine with other datasets. (Use the to_lower = FALSE argument to turn off this behavior).</p>
<ol start="2" type="1">
<li><strong>Apply unnest_tokens to your tidied book to unnest this text. Next, once again use the <code>View()</code> function to examine the output.</strong></li>
</ol>
<p><em>Hint</em>: As with Question 1, ensure to use the piping operator (<code>%&gt;%</code>) to easily apply the function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>tidy_AAIWL <span class="ot">&lt;-</span> tidy_AAIWL <span class="sc">%&gt;%</span> <span class="fu">unnest_tokens</span>(word, text)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>tidy_SCJH <span class="ot">&lt;-</span> tidy_SCJH <span class="sc">%&gt;%</span> <span class="fu">unnest_tokens</span>(word, text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This results in one word being linked per row of the data frame. The benefit of using the <code>tidytext</code> package in comparison to other text mining packages, is that this automatically applies some of the basic steps to pre-process your text, including removing of capital letters, inter-word punctuation and numbers. However additional pre-processing is required.</p>
</section>
<section id="intermezzo-word-clouds" class="level3" data-number="8.11.3">
<h3 data-number="8.11.3" class="anchored" data-anchor-id="intermezzo-word-clouds"><span class="header-section-number">8.11.3</span> Intermezzo: Word clouds</h3>
<p>Before continuing the pre-processing process, let’s have a first look at our text by making a simple visualization using word clouds. Typically these word clouds visualize the frequency of words in a text through relating the size of the displayed words to frequency, with the largest words indicating the most common words.</p>
<p>To plot word clouds, we first have to create a data frame containing the word frequencies.</p>
<ol start="3" type="1">
<li><strong>Create a new data frame, which contains the frequencies of words from the unnested text. To do this, you can make use of the function <code>count()</code>.</strong></li>
</ol>
<p><em>Hint</em>: As with Question 1, ensure to use the piping operator (<code>%&gt;%</code>) to easily apply the function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>tidy_AAIWL.count <span class="ot">&lt;-</span> tidy_AAIWL <span class="sc">%&gt;%</span> <span class="fu">count</span>(word, <span class="at">sort=</span><span class="cn">TRUE</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>tidy_SCJH.count <span class="ot">&lt;-</span> tidy_SCJH <span class="sc">%&gt;%</span> <span class="fu">count</span>(word, <span class="at">sort=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li><strong>Using the <code>wordcloud()</code> function, create a word cloud for your book text. Use the argument <code>max.words</code> within the function to set the maximum number of words to be displayed in the word cloud.</strong></li>
</ol>
<p><em>Hint</em>: As with Question 1, ensure to use the piping operator (<code>%&gt;%</code>) to easily apply the function. <em>Note</em>: Ensure to use the function <code>with()</code>, is used after the piping operator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>tidy_AAIWL.count <span class="sc">%&gt;%</span> <span class="fu">with</span>(<span class="fu">wordcloud</span>(word, n, <span class="at">max.words =</span> <span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="text-mining_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>tidy_SCJH.count <span class="sc">%&gt;%</span> <span class="fu">with</span>(<span class="fu">wordcloud</span>(word, n, <span class="at">max.words =</span> <span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="text-mining_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<ol start="5" type="1">
<li><strong>Discuss with another individual or group, whether you can tell what text each word clouds come from, based on the popular words which occur.</strong></li>
</ol>
</section>
<section id="step-2-removing-stop-words" class="level3" data-number="8.11.4">
<h3 data-number="8.11.4" class="anchored" data-anchor-id="step-2-removing-stop-words"><span class="header-section-number">8.11.4</span> Step 2: Removing stop words</h3>
<p>As discussed within the lecture, stop words are words in any language which have little or no meaning, and simply connect the words of importance. Such as <em>the</em>, <em>a</em>, <em>also</em>, <em>as</em>, <em>were</em>… etc. To understand the importance of removing these stop words, we can simply do a comparison between the text which has had them removed and those which have not been.</p>
<p>To remove the stop words, we use the function <code>anti_join()</code>. This function works through <em>un-joining</em> this table based upon the components, which when passed with the argument <code>stop_words</code>, which is a table containing these words across three lexicons. This removes all the stop words from the presented data frame.</p>
<ol start="6" type="1">
<li><strong>Use the function <code>anti_join()</code> to remove stop words from your tidied text attaching it to a new data frame.</strong></li>
</ol>
<p><em>Hint</em>: As with Question 1, ensure to use the piping operator (<code>%&gt;%</code>) to easily apply the function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"stop_words"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>tidy_AAIWL.stop <span class="ot">&lt;-</span> tidy_AAIWL <span class="sc">%&gt;%</span> <span class="fu">anti_join</span>(stop_words)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(word)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>tidy_SCJH.stop <span class="ot">&lt;-</span> tidy_SCJH <span class="sc">%&gt;%</span> <span class="fu">anti_join</span>(stop_words)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(word)`</code></pre>
</div>
</div>
<p>In order to examine the impact of removing these filler words, we can use the <code>count()</code> function to examine the frequencies of different words. This when sorted, will produce a table of frequencies in descending order. An other option is to redo the wordclouds on the updated data frame containing the word counts of the tidied book text without stop words.</p>
<ol start="7" type="1">
<li><strong>Use the function <code>count()</code> to compare the frequencies of words in the dataframes containing the tidied book text with and without stop words (use <code>sort = TRUE</code> within the <code>count()</code> function), or redo the wordclouds. Do you notice a difference in the (top 10) words which most commonly occur in the text?</strong></li>
</ol>
<p><em>Hint</em>: As with Question 1, ensure to use the piping operator (<code>%&gt;%</code>) to easily apply the function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>tidy_AAIWL.count <span class="ot">&lt;-</span> tidy_AAIWL.stop <span class="sc">%&gt;%</span> <span class="fu">count</span>(word, <span class="at">sort=</span><span class="cn">TRUE</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>tidy_AAIWL.count <span class="sc">%&gt;%</span> <span class="fu">with</span>(<span class="fu">wordcloud</span>(word, n, <span class="at">max.words =</span> <span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="text-mining_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="vector-space-model-document-term-matrix" class="level2" data-number="8.12">
<h2 data-number="8.12" class="anchored" data-anchor-id="vector-space-model-document-term-matrix"><span class="header-section-number">8.12</span> Vector space model: document-term matrix</h2>
<p>In this part of the practical we will build a text classification model for a multiclass classification task. To this end, we first need to perform text preprocessing, then using the idea of vector space model, convert the text data into a document-term (dtm) matrix, and finally train a classifier on the dtm matrix.</p>
<p>The data set used in this part of the practical is the BBC News data set. You can use the provided “news_dataset.rda” for this purpose. <!-- The raw data set can also be downloaded from [here](http://mlg.ucd.ie/datasets/bbc.html). --> This data set consists of 2225 documents from the BBC news website corresponding to stories in five topical areas from 2004 to 2005. These areas are:</p>
<ul>
<li>Business</li>
<li>Entertainment</li>
<li>Politics</li>
<li>Sport</li>
<li>Tech</li>
</ul>
<ol start="8" type="1">
<li><strong>Use the code below to load the data set and inspect its first rows.</strong></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/news_dataset.rda"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_final)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  File_Name
1   001.txt
2   002.txt
3   003.txt
4   004.txt
5   005.txt
6   006.txt
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Content
1 Ad sales boost Time Warner profit\n\nQuarterly profits at US media giant TimeWarner jumped 76% to $1.13bn (£600m) for the three months to December, from $639m year-earlier.\n\nThe firm, which is now one of the biggest investors in Google, benefited from sales of high-speed internet connections and higher advert sales. TimeWarner said fourth quarter sales rose 2% to $11.1bn from $10.9bn. Its profits were buoyed by one-off gains which offset a profit dip at Warner Bros, and less users for AOL.\n\nTime Warner said on Friday that it now owns 8% of search-engine Google. But its own internet business, AOL, had has mixed fortunes. It lost 464,000 subscribers in the fourth quarter profits were lower than in the preceding three quarters. However, the company said AOL's underlying profit before exceptional items rose 8% on the back of stronger internet advertising revenues. It hopes to increase subscribers by offering the online service free to TimeWarner internet customers and will try to sign up AOL's existing customers for high-speed broadband. TimeWarner also has to restate 2000 and 2003 results following a probe by the US Securities Exchange Commission (SEC), which is close to concluding.\n\nTime Warner's fourth quarter profits were slightly better than analysts' expectations. But its film division saw profits slump 27% to $284m, helped by box-office flops Alexander and Catwoman, a sharp contrast to year-earlier, when the third and final film in the Lord of the Rings trilogy boosted results. For the full-year, TimeWarner posted a profit of $3.36bn, up 27% from its 2003 performance, while revenues grew 6.4% to $42.09bn. "Our financial performance was strong, meeting or exceeding all of our full-year objectives and greatly enhancing our flexibility," chairman and chief executive Richard Parsons said. For 2005, TimeWarner is projecting operating earnings growth of around 5%, and also expects higher revenue and wider profit margins.\n\nTimeWarner is to restate its accounts as part of efforts to resolve an inquiry into AOL by US market regulators. It has already offered to pay $300m to settle charges, in a deal that is under review by the SEC. The company said it was unable to estimate the amount it needed to set aside for legal reserves, which it previously set at $500m. It intends to adjust the way it accounts for a deal with German music publisher Bertelsmann's purchase of a stake in AOL Europe, which it had reported as advertising revenue. It will now book the sale of its stake in AOL Europe as a loss on the value of that stake.
2                                                                                                                                                                                                                                                                                                                        Dollar gains on Greenspan speech\n\nThe dollar has hit its highest level against the euro in almost three months after the Federal Reserve head said the US trade deficit is set to stabilise.\n\nAnd Alan Greenspan highlighted the US government's willingness to curb spending and rising household savings as factors which may help to reduce it. In late trading in New York, the dollar reached $1.2871 against the euro, from $1.2974 on Thursday. Market concerns about the deficit has hit the greenback in recent months. On Friday, Federal Reserve chairman Mr Greenspan's speech in London ahead of the meeting of G7 finance ministers sent the dollar higher after it had earlier tumbled on the back of worse-than-expected US jobs data. "I think the chairman's taking a much more sanguine view on the current account deficit than he's taken for some time," said Robert Sinche, head of currency strategy at Bank of America in New York. "He's taking a longer-term view, laying out a set of conditions under which the current account deficit can improve this year and next."\n\nWorries about the deficit concerns about China do, however, remain. China's currency remains pegged to the dollar and the US currency's sharp falls in recent months have therefore made Chinese export prices highly competitive. But calls for a shift in Beijing's policy have fallen on deaf ears, despite recent comments in a major Chinese newspaper that the "time is ripe" for a loosening of the peg. The G7 meeting is thought unlikely to produce any meaningful movement in Chinese policy. In the meantime, the US Federal Reserve's decision on 2 February to boost interest rates by a quarter of a point - the sixth such move in as many months - has opened up a differential with European rates. The half-point window, some believe, could be enough to keep US assets looking more attractive, and could help prop up the dollar. The recent falls have partly been the result of big budget deficits, as well as the US's yawning current account gap, both of which need to be funded by the buying of US bonds and assets by foreign firms and governments. The White House will announce its budget on Monday, and many commentators believe the deficit will remain at close to half a trillion dollars.
3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Yukos unit buyer faces loan claim\n\nThe owners of embattled Russian oil giant Yukos are to ask the buyer of its former production unit to pay back a $900m (£479m) loan.\n\nState-owned Rosneft bought the Yugansk unit for $9.3bn in a sale forced by Russia to part settle a $27.5bn tax claim against Yukos. Yukos' owner Menatep Group says it will ask Rosneft to repay a loan that Yugansk had secured on its assets. Rosneft already faces a similar $540m repayment demand from foreign banks. Legal experts said Rosneft's purchase of Yugansk would include such obligations. "The pledged assets are with Rosneft, so it will have to pay real money to the creditors to avoid seizure of Yugansk assets," said Moscow-based US lawyer Jamie Firestone, who is not connected to the case. Menatep Group's managing director Tim Osborne told the Reuters news agency: "If they default, we will fight them where the rule of law exists under the international arbitration clauses of the credit."\n\nRosneft officials were unavailable for comment. But the company has said it intends to take action against Menatep to recover some of the tax claims and debts owed by Yugansk. Yukos had filed for bankruptcy protection in a US court in an attempt to prevent the forced sale of its main production arm. The sale went ahead in December and Yugansk was sold to a little-known shell company which in turn was bought by Rosneft. Yukos claims its downfall was punishment for the political ambitions of its founder Mikhail Khodorkovsky and has vowed to sue any participant in the sale.
4                                                                                                                                                               High fuel prices hit BA's profits\n\nBritish Airways has blamed high fuel prices for a 40% drop in profits.\n\nReporting its results for the three months to 31 December 2004, the airline made a pre-tax profit of £75m ($141m) compared with £125m a year earlier. Rod Eddington, BA's chief executive, said the results were "respectable" in a third quarter when fuel costs rose by £106m or 47.3%. BA's profits were still better than market expectation of £59m, and it expects a rise in full-year revenues.\n\nTo help offset the increased price of aviation fuel, BA last year introduced a fuel surcharge for passengers.\n\nIn October, it increased this from £6 to £10 one-way for all long-haul flights, while the short-haul surcharge was raised from £2.50 to £4 a leg. Yet aviation analyst Mike Powell of Dresdner Kleinwort Wasserstein says BA's estimated annual surcharge revenues - £160m - will still be way short of its additional fuel costs - a predicted extra £250m. Turnover for the quarter was up 4.3% to £1.97bn, further benefiting from a rise in cargo revenue. Looking ahead to its full year results to March 2005, BA warned that yields - average revenues per passenger - were expected to decline as it continues to lower prices in the face of competition from low-cost carriers. However, it said sales would be better than previously forecast. "For the year to March 2005, the total revenue outlook is slightly better than previous guidance with a 3% to 3.5% improvement anticipated," BA chairman Martin Broughton said. BA had previously forecast a 2% to 3% rise in full-year revenue.\n\nIt also reported on Friday that passenger numbers rose 8.1% in January. Aviation analyst Nick Van den Brul of BNP Paribas described BA's latest quarterly results as "pretty modest". "It is quite good on the revenue side and it shows the impact of fuel surcharges and a positive cargo development, however, operating margins down and cost impact of fuel are very strong," he said. Since the 11 September 2001 attacks in the United States, BA has cut 13,000 jobs as part of a major cost-cutting drive. "Our focus remains on reducing controllable costs and debt whilst continuing to invest in our products," Mr Eddington said. "For example, we have taken delivery of six Airbus A321 aircraft and next month we will start further improvements to our Club World flat beds." BA's shares closed up four pence at 274.5 pence.
5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Pernod takeover talk lifts Domecq\n\nShares in UK drinks and food firm Allied Domecq have risen on speculation that it could be the target of a takeover by France's Pernod Ricard.\n\nReports in the Wall Street Journal and the Financial Times suggested that the French spirits firm is considering a bid, but has yet to contact its target. Allied Domecq shares in London rose 4% by 1200 GMT, while Pernod shares in Paris slipped 1.2%. Pernod said it was seeking acquisitions but refused to comment on specifics.\n\nPernod's last major purchase was a third of US giant Seagram in 2000, the move which propelled it into the global top three of drinks firms. The other two-thirds of Seagram was bought by market leader Diageo. In terms of market value, Pernod - at 7.5bn euros ($9.7bn) - is about 9% smaller than Allied Domecq, which has a capitalisation of £5.7bn ($10.7bn; 8.2bn euros). Last year Pernod tried to buy Glenmorangie, one of Scotland's premier whisky firms, but lost out to luxury goods firm LVMH. Pernod is home to brands including Chivas Regal Scotch whisky, Havana Club rum and Jacob's Creek wine. Allied Domecq's big names include Malibu rum, Courvoisier brandy, Stolichnaya vodka and Ballantine's whisky - as well as snack food chains such as Dunkin' Donuts and Baskin-Robbins ice cream. The WSJ said that the two were ripe for consolidation, having each dealt with problematic parts of their portfolio. Pernod has reduced the debt it took on to fund the Seagram purchase to just 1.8bn euros, while Allied has improved the performance of its fast-food chains.
6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 Japan narrowly escapes recession\n\nJapan's economy teetered on the brink of a technical recession in the three months to September, figures show.\n\nRevised figures indicated growth of just 0.1% - and a similar-sized contraction in the previous quarter. On an annual basis, the data suggests annual growth of just 0.2%, suggesting a much more hesitant recovery than had previously been thought. A common technical definition of a recession is two successive quarters of negative growth.\n\nThe government was keen to play down the worrying implications of the data. "I maintain the view that Japan's economy remains in a minor adjustment phase in an upward climb, and we will monitor developments carefully," said economy minister Heizo Takenaka. But in the face of the strengthening yen making exports less competitive and indications of weakening economic conditions ahead, observers were less sanguine. "It's painting a picture of a recovery... much patchier than previously thought," said Paul Sheard, economist at Lehman Brothers in Tokyo. Improvements in the job market apparently have yet to feed through to domestic demand, with private consumption up just 0.2% in the third quarter.
  Category Complete_Filename
1 business  001.txt-business
2 business  002.txt-business
3 business  003.txt-business
4 business  004.txt-business
5 business  005.txt-business
6 business  006.txt-business</code></pre>
</div>
</div>
<ol start="9" type="1">
<li><strong>Find out about the name of the categories and the number of observations in each of them.</strong></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>t_category <span class="ot">&lt;-</span> <span class="fu">table</span>(df_final<span class="sc">$</span>Category)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>t_name <span class="ot">&lt;-</span> <span class="fu">table</span>(df_final<span class="sc">$</span>File_Name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="10" type="1">
<li><strong>Convert the data set into a document-term matrix using the function <code>DocumentTermMatrix()</code> and subsequently use the <code>findFreqTerms()</code> function to keep the terms which their frequency is larger than 10. A start of the code is given below. It is also a good idea to apply some text preprocessing, for this inspect the <code>control</code> argument of the function <code>DocumentTermMatrix()</code> (e.g., convert the words into lowercase, remove punctuations, numbers, stopwords, and whitespaces).</strong></li>
</ol>
<div class="cell" data-evaluate="false">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="do">### set the seed to make your partition reproducible</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>df_final<span class="sc">$</span>Content <span class="ot">&lt;-</span> <span class="fu">iconv</span>(df_final<span class="sc">$</span>Content, <span class="at">from =</span> <span class="st">"UTF-8"</span>, <span class="at">to =</span> <span class="st">"ASCII"</span>, <span class="at">sub =</span> <span class="st">""</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>docs <span class="ot">&lt;-</span> <span class="fu">Corpus</span>(<span class="fu">VectorSource</span>(df_final<span class="sc">$</span>Content)) <span class="co">#for documenttermmatrix we need a corpus format, a list ot content and the meta data </span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="do">## alter the code from here onwards</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>dtm <span class="ot">&lt;-</span> <span class="fu">DocumentTermMatrix</span>(docs,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">control =</span> <span class="fu">list</span>(<span class="at">stopwords=</span> <span class="cn">TRUE</span>, </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">removeNumbers=</span><span class="cn">TRUE</span>,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">removePunctuation=</span><span class="cn">TRUE</span>,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">whitespace_tokenizer=</span><span class="cn">TRUE</span>,</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">tolower=</span><span class="cn">TRUE</span>))  <span class="co">#lower case</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#in the rows are the entries, in the columns the frequency of a word</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>not.freq <span class="ot">&lt;-</span> <span class="fu">findFreqTerms</span>(dtm, <span class="at">lowfreq=</span><span class="dv">11</span>) <span class="do">## we are not interested in all the words, we are only interested in words that are used more than 10 times</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>dtm <span class="ot">&lt;-</span> <span class="fu">DocumentTermMatrix</span>(docs,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">control =</span> <span class="fu">list</span>(<span class="at">stopwords=</span> <span class="cn">TRUE</span>, </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">removeNumbers=</span><span class="cn">TRUE</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">removePunctuation=</span><span class="cn">TRUE</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">whitespace_tokenizer=</span><span class="cn">TRUE</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">tolower=</span><span class="cn">TRUE</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">dictionary =</span> not.freq))  <span class="co">#lower case</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="11" type="1">
<li><strong>Partition the original data into training and test sets with 80% for training and 20% for test.</strong></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">## define the training partition </span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>train_index <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(df_final<span class="sc">$</span>Category, <span class="at">p =</span> .<span class="dv">8</span>,  <span class="co">#category because outcome variable</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">list =</span> <span class="cn">FALSE</span>, </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">times =</span> <span class="dv">1</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="do">## split the data using the training partition to obtain training data</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">&lt;-</span> df_final[train_index,]</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="do">## remainder of the split is the validation and test data (still) combined </span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>df_test <span class="ot">&lt;-</span> df_final[<span class="sc">-</span>train_index,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="12" type="1">
<li><strong>Create separate document-term matrices for the training and the test sets using the previous frequent terms as the input dictionary and convert them into data frames.</strong></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df_train<span class="sc">$</span>Content <span class="ot">&lt;-</span> <span class="fu">iconv</span>(df_train<span class="sc">$</span>Content, <span class="at">from =</span> <span class="st">"UTF-8"</span>, <span class="at">to =</span> <span class="st">"ASCII"</span>, <span class="at">sub =</span> <span class="st">""</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>df_test<span class="sc">$</span>Content <span class="ot">&lt;-</span> <span class="fu">iconv</span>(df_test<span class="sc">$</span>Content, <span class="at">from =</span> <span class="st">"UTF-8"</span>, <span class="at">to =</span> <span class="st">"ASCII"</span>, <span class="at">sub =</span> <span class="st">""</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>docs_train <span class="ot">&lt;-</span> <span class="fu">Corpus</span>(<span class="fu">VectorSource</span>(df_train<span class="sc">$</span>Category)) </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>docs_test <span class="ot">&lt;-</span> <span class="fu">Corpus</span>(<span class="fu">VectorSource</span>(df_test<span class="sc">$</span>Category)) </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="do">## alter the code from here onwards</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>dtm_train <span class="ot">&lt;-</span> <span class="fu">DocumentTermMatrix</span>(docs_train,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">control =</span> <span class="fu">list</span>(<span class="at">stopwords=</span> <span class="cn">TRUE</span>, </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">removeNumbers=</span><span class="cn">TRUE</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">removePunctuation=</span><span class="cn">TRUE</span>,</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">whitespace_tokenizer=</span><span class="cn">TRUE</span>,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">tolower=</span><span class="cn">TRUE</span>,</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">dictionary=</span> not.freq))  </span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="do">## alter the code from here onwards</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>dtm_test <span class="ot">&lt;-</span> <span class="fu">DocumentTermMatrix</span>(docs_test,</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>                          <span class="at">control =</span> <span class="fu">list</span>(<span class="at">stopwords=</span> <span class="cn">TRUE</span>, </span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">removeNumbers=</span><span class="cn">TRUE</span>,</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">removePunctuation=</span><span class="cn">TRUE</span>,</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">whitespace_tokenizer=</span><span class="cn">TRUE</span>,</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">tolower=</span><span class="cn">TRUE</span>,</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">dictionary=</span> not.freq))  </span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="co">#make a data frame </span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>dtm_train  <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.matrix</span>(dtm_train))</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>dtm_test  <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.matrix</span>(dtm_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="13" type="1">
<li><strong>Use the <code>cbind</code> function to add the categories to the train_dtm data and name the column y.</strong></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> df_train<span class="sc">$</span>Category</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>dtm_train <span class="ot">&lt;-</span> <span class="fu">cbind</span>(dtm_train,y)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dtm_train[<span class="dv">5</span>,<span class="dv">6216</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
business 
       1 </code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./tree-based.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Tree-based Methods</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



</body></html>